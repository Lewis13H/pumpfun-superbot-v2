<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Detail - Loading...</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }
        
        /* Token Header */
        .token-header {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 1px solid #2a2a2a;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .token-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .token-icon {
            width: 40px;
            height: 40px;
            background: #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .token-name {
            font-size: 20px;
            font-weight: 600;
        }
        
        .token-symbol {
            color: #888;
            font-size: 14px;
        }
        
        .price-display {
            text-align: right;
        }
        
        .price {
            font-size: 24px;
            font-weight: 600;
        }
        
        .price-change {
            font-size: 13px;
            margin-top: 2px;
        }
        
        .header-stats {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #aaa;
        }
        
        .header-stats span {
            color: #fff;
            font-weight: 600;
        }
        
        /* Score Cards Container */
        .score-cards-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        /* Score Badge */
        .score-badge {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #2a2a2a;
        }
        
        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .score-title {
            font-size: 12px;
            font-weight: 600;
            color: #aaa;
        }
        
        .score-value {
            font-size: 16px;
            font-weight: 700;
            display: block;
            margin-top: 4px;
        }
        
        .score-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: #4CAF50;
            color: white;
        }
        
        .score-bar {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
        }
        
        /* Different score colors */
        .score-total .score-fill {
            background: linear-gradient(90deg, #2196F3, #03A9F4);
        }
        
        .score-bc .score-fill {
            background: linear-gradient(90deg, #FF9800, #FFC107);
        }
        
        .score-social .score-fill {
            background: linear-gradient(90deg, #9C27B0, #E91E63);
        }
        
        .score-technical .score-fill {
            background: linear-gradient(90deg, #607D8B, #78909C);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 15px;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 4px;
            border: 1px solid #2a2a2a;
        }
        
        .tab {
            flex: 1;
            padding: 8px 16px;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .tab:hover {
            background: #222;
        }
        
        .tab.active {
            background: #2a2a2a;
            color: #4CAF50;
        }
        
        /* Content Area */
        .content-area {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #2a2a2a;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
        }
        
        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        /* Score Breakdown */
        .score-breakdown {
            background: #222;
            border-radius: 6px;
            padding: 15px;
            font-size: 12px;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }
        
        .score-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .score-label {
            color: #aaa;
        }
        
        .score-points {
            font-weight: 600;
        }
        
        .negative {
            color: #f44336;
        }
        
        .positive {
            color: #4CAF50;
        }
        
        /* Distribution Chart */
        .distribution-chart {
            background: #222;
            border-radius: 6px;
            padding: 15px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .chart-placeholder {
            width: 150px;
            height: 150px;
            background: #333;
            border-radius: 50%;
            margin-bottom: 15px;
        }
        
        .chart-legend {
            font-size: 11px;
            width: 100%;
        }
        
        .legend-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        /* Metric Box */
        .metric-box {
            background: #222;
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }
        
        .metric-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }
        
        /* Table Styles */
        .data-table {
            width: 100%;
            font-size: 12px;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-table th {
            background: #222;
            padding: 8px 12px;
            text-align: left;
            font-weight: 600;
            color: #aaa;
            font-size: 11px;
            text-transform: uppercase;
            border-bottom: 1px solid #333;
        }
        
        .data-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #2a2a2a;
        }
        
        .data-table tr:hover {
            background: #222;
        }
        
        /* Risk Badges */
        .risk-low {
            color: #4CAF50;
        }
        
        .risk-medium {
            color: #ff9800;
        }
        
        .risk-high {
            color: #f44336;
        }
        
        /* Address */
        .address {
            font-family: monospace;
            color: #66b3ff;
            cursor: pointer;
        }
        
        .address:hover {
            text-decoration: underline;
        }
        
        /* External Links */
        .external-links {
            display: flex;
            gap: 12px;
            margin-top: 10px;
            font-size: 11px;
        }
        
        .external-link {
            color: #66b3ff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .external-link:hover {
            color: #4CAF50;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 100px 20px;
            font-size: 18px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 100px 20px;
            color: #f44336;
            font-size: 18px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .score-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header - Exact copy from index.html -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                🚀 PumpMonitor
            </a>
            <nav class="nav-links">
                <a href="/" class="nav-link">Tokens</a>
                <a href="/streaming-metrics.html" class="nav-link">Stream</a>
            </nav>
            <div class="header-right">
                <div class="sol-price-display">
                    <span class="sol-price-label">SOL</span>
                    <span class="sol-price-value" id="header-sol-price">$0.00</span>
                    <span class="sol-price-timestamp" id="header-sol-timestamp" title="Last updated"></span>
                </div>
                <div class="connection-status" id="connection-status">
                    <div class="status-dot" id="status-dot"></div>
                    <span class="stream-icon" id="stream-icon">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <span class="status-text" id="status-text">Disconnected</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Loading/Error States -->
        <div id="loading" class="loading">Loading token details...</div>
        <div id="error" class="error" style="display: none;">Failed to load token details</div>
        
        <!-- Main Content (hidden while loading) -->
        <div id="content" style="display: none;">
            <!-- Token Header -->
            <div class="token-header">
                <div class="header-top">
                    <div class="token-title">
                        <div class="token-icon" id="token-icon">🪙</div>
                        <div>
                            <div class="token-name">
                                <span id="token-name">Loading...</span> <span class="token-symbol">(<span id="token-symbol">...</span>)</span>
                            </div>
                            <div class="external-links">
                                <a href="#" id="pump-link" class="external-link" target="_blank">🟢 Pump.fun ↗</a>
                                <a href="#" id="dexscreener-link" class="external-link" target="_blank">📊 DexScreener ↗</a>
                                <a href="#" id="birdeye-link" class="external-link" target="_blank">🦅 Birdeye ↗</a>
                                <a href="#" id="solscan-link" class="external-link" target="_blank">🔍 Solscan ↗</a>
                            </div>
                        </div>
                    </div>
                    <div class="price-display">
                        <div class="price" id="token-price">$0.00</div>
                        <div class="price-change" id="price-change">+0.0% (24h)</div>
                    </div>
                </div>
                <div class="header-stats">
                    <div>Market Cap: <span id="market-cap">$0</span></div>
                    <div>24h Volume: <span id="volume-24h">$0</span></div>
                    <div>Holders: <span id="holder-count">0</span></div>
                    <div>Liquidity: <span id="liquidity">0 SOL</span></div>
                    <div>Progress: <span id="progress">0%</span></div>
                </div>
            </div>

            <!-- Score Cards - 5 columns -->
            <div class="score-cards-container">
                <!-- Total Score -->
                <div class="score-badge score-total">
                    <div class="score-header">
                        <div>
                            <div class="score-title">Total Score</div>
                            <div class="score-value"><span id="total-score">0</span>/1000</div>
                        </div>
                    </div>
                    <div class="score-bar">
                        <div class="score-fill" id="total-score-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Holder Score -->
                <div class="score-badge">
                    <div class="score-header">
                        <div>
                            <div class="score-title">Holder Score</div>
                            <div class="score-value"><span id="holder-score">0</span>/300</div>
                        </div>
                    </div>
                    <div class="score-bar">
                        <div class="score-fill" id="holder-score-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- BC Curve Score -->
                <div class="score-badge score-bc">
                    <div class="score-header">
                        <div>
                            <div class="score-title">BC Curve Score</div>
                            <div class="score-value"><span id="bc-score">0</span>/300</div>
                        </div>
                    </div>
                    <div class="score-bar">
                        <div class="score-fill" id="bc-score-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Social Score -->
                <div class="score-badge score-social">
                    <div class="score-header">
                        <div>
                            <div class="score-title">Social Score</div>
                            <div class="score-value"><span id="social-score">0</span>/200</div>
                        </div>
                    </div>
                    <div class="score-bar">
                        <div class="score-fill" id="social-score-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Technical Score -->
                <div class="score-badge score-technical">
                    <div class="score-header">
                        <div>
                            <div class="score-title">Technical Score</div>
                            <div class="score-value"><span id="technical-score">0</span>/200</div>
                        </div>
                    </div>
                    <div class="score-bar">
                        <div class="score-fill" id="technical-score-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tabs">
                <button class="tab" onclick="switchTab('overview')">Overview</button>
                <button class="tab" onclick="switchTab('chart')">Price Chart</button>
                <button class="tab active" onclick="switchTab('holders')">Holders</button>
                <button class="tab" onclick="switchTab('transactions')">Transactions</button>
                <button class="tab" onclick="switchTab('pool')">Pool</button>
            </div>

            <!-- Content Area - Dynamic based on tab -->
            <div class="content-area" id="tab-content">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Get token address from URL
        const urlParams = new URLSearchParams(window.location.search);
        const tokenAddress = urlParams.get('address');
        let currentTab = 'holders';
        let tokenData = null;

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            renderTabContent();
        }

        // Render tab content
        function renderTabContent() {
            const content = document.getElementById('tab-content');
            
            switch(currentTab) {
                case 'overview':
                    content.innerHTML = '<h2 class="section-title">Token Overview</h2><p>Overview content coming soon...</p>';
                    break;
                case 'chart':
                    content.innerHTML = '<h2 class="section-title">Price Chart</h2><p>Chart integration coming soon...</p>';
                    break;
                case 'holders':
                    renderHoldersTab();
                    break;
                case 'transactions':
                    content.innerHTML = '<h2 class="section-title">Recent Transactions</h2><p>Transactions coming soon...</p>';
                    break;
                case 'pool':
                    content.innerHTML = '<h2 class="section-title">Pool Information</h2><p>Pool info coming soon...</p>';
                    break;
            }
        }

        // Render holders tab
        function renderHoldersTab() {
            const content = document.getElementById('tab-content');
            content.innerHTML = `
                <h2 class="section-title">Holder Analytics</h2>
                
                <!-- Score Breakdown and Distribution -->
                <div class="grid-2" style="margin-bottom: 20px;">
                    <div class="score-breakdown">
                        <h3 style="font-size: 14px; margin-bottom: 12px;">Score Breakdown</h3>
                        <div class="score-item">
                            <span class="score-label">Distribution</span>
                            <span class="score-points">45/50</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">Decentralized</span>
                            <span class="score-points">40/50</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">Organic</span>
                            <span class="score-points">25/30</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">Dev Ethics</span>
                            <span class="score-points">15/20</span>
                        </div>
                        <div class="score-item" style="border-top: 1px solid #333; padding-top: 8px; margin-top: 8px;">
                            <span class="score-label">Sniper Risk</span>
                            <span class="score-points negative">-15</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">Bot Activity</span>
                            <span class="score-points negative">-10</span>
                        </div>
                        <div class="score-item" style="border-top: 2px solid #333; padding-top: 8px; margin-top: 8px;">
                            <span class="score-label" style="font-weight: 600;">Total</span>
                            <span class="score-points" style="font-size: 14px;">245/300</span>
                        </div>
                    </div>
                    
                    <div class="distribution-chart">
                        <div class="chart-placeholder"></div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <span>🟢 Organic</span>
                                <span>65%</span>
                            </div>
                            <div class="legend-item">
                                <span>🔴 Snipers</span>
                                <span>15%</span>
                            </div>
                            <div class="legend-item">
                                <span>🤖 Bots</span>
                                <span>10%</span>
                            </div>
                            <div class="legend-item">
                                <span>🐋 Whales</span>
                                <span>8%</span>
                            </div>
                            <div class="legend-item">
                                <span>👨‍💻 Dev</span>
                                <span>2%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics Grid -->
                <div class="grid-4" style="margin-bottom: 20px;">
                    <div class="metric-box">
                        <div class="metric-label">Total Holders</div>
                        <div class="metric-value" id="metric-holders">0</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Top 10 Hold</div>
                        <div class="metric-value" id="metric-top10">0%</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Top 25 Hold</div>
                        <div class="metric-value" id="metric-top25">0%</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Gini Coef</div>
                        <div class="metric-value" id="metric-gini">0.00</div>
                    </div>
                </div>

                <!-- Tables will be added here if holder data is available -->
                <div id="holder-tables"></div>
            `;
        }

        // Load token data
        async function loadTokenData() {
            if (!tokenAddress) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'No token address provided';
                return;
            }

            try {
                const response = await fetch(`/api/v1/tokens/${tokenAddress}`);
                if (!response.ok) throw new Error('Failed to fetch token data');
                
                tokenData = await response.json();
                
                // Update UI with token data
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
                updateTokenDisplay();
                renderTabContent();
                
                // Set page title
                document.title = `${tokenData.symbol || 'Token'} - Token Detail`;
                
            } catch (error) {
                console.error('Error loading token:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }

        // Update token display
        function updateTokenDisplay() {
            // Basic info
            document.getElementById('token-name').textContent = tokenData.name || 'Unknown';
            document.getElementById('token-symbol').textContent = tokenData.symbol || '???';
            document.getElementById('token-price').textContent = `$${formatNumber(tokenData.price_usd || 0, 6)}`;
            
            // Stats
            document.getElementById('market-cap').textContent = `$${formatNumber(tokenData.market_cap || 0)}`;
            document.getElementById('volume-24h').textContent = `$${formatNumber(tokenData.volume_24h || 0)}`;
            document.getElementById('holder-count').textContent = formatNumber(tokenData.holder_count || 0);
            document.getElementById('liquidity').textContent = `${formatNumber(tokenData.liquidity_sol || 0)} SOL`;
            document.getElementById('progress').textContent = `${(tokenData.bonding_curve_progress || 0).toFixed(1)}%`;
            
            // External links
            document.getElementById('pump-link').href = `https://pump.fun/${tokenAddress}`;
            document.getElementById('dexscreener-link').href = `https://dexscreener.com/solana/${tokenAddress}`;
            document.getElementById('birdeye-link').href = `https://birdeye.so/token/${tokenAddress}`;
            document.getElementById('solscan-link').href = `https://solscan.io/token/${tokenAddress}`;
            
            // Scores (using holder score for now, will expand later)
            const holderScore = tokenData.holder_score || 0;
            document.getElementById('holder-score').textContent = holderScore;
            document.getElementById('holder-score-fill').style.width = `${(holderScore / 300) * 100}%`;
            
            // Placeholder scores for now
            document.getElementById('total-score').textContent = holderScore;
            document.getElementById('total-score-fill').style.width = `${(holderScore / 1000) * 100}%`;
            
            document.getElementById('bc-score').textContent = Math.round(holderScore * 0.8);
            document.getElementById('bc-score-fill').style.width = `${(holderScore * 0.8 / 300) * 100}%`;
            
            document.getElementById('social-score').textContent = Math.round(holderScore * 0.5);
            document.getElementById('social-score-fill').style.width = `${(holderScore * 0.5 / 200) * 100}%`;
            
            document.getElementById('technical-score').textContent = Math.round(holderScore * 0.6);
            document.getElementById('technical-score-fill').style.width = `${(holderScore * 0.6 / 200) * 100}%`;
            
            // Update metrics if available
            if (tokenData.holder_analysis) {
                document.getElementById('metric-holders').textContent = formatNumber(tokenData.holder_analysis.total_holders || 0);
                document.getElementById('metric-top10').textContent = `${(tokenData.holder_analysis.top_10_percentage || 0).toFixed(1)}%`;
                document.getElementById('metric-top25').textContent = `${(tokenData.holder_analysis.top_25_percentage || 0).toFixed(1)}%`;
                document.getElementById('metric-gini').textContent = (tokenData.holder_analysis.gini_coefficient || 0).toFixed(2);
            }
        }

        // Format number helper
        function formatNumber(num, decimals = 2) {
            if (num >= 1e9) return (num / 1e9).toFixed(decimals) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(decimals) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(decimals) + 'K';
            return num.toFixed(decimals);
        }

        // Initialize
        loadTokenData();
        
        // Auto refresh every 30 seconds
        setInterval(loadTokenData, 30000);
    </script>
</body>
</html>